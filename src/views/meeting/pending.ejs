<%- include('../layout', { title: 'Waiting for Approval' , body: ` <div class="container text-center py-5">
    <div class="spinner-border text-primary mb-3" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <h3>Waiting for host approval</h3>
    <p class="text-muted">The host will approve your request to join this meeting.</p>
    <p><strong>Meeting:</strong> ${meeting.title}</p>
    <a href="/meeting" class="btn btn-secondary mt-3">Back to Meetings</a>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const meetingId = '${meeting._id}';
        const userId = '${user._id}';
        const userName = '${user.name}';
        const userEmail = '${user.email || ""}';

        console.log('ðŸ“„ PENDING PAGE: Waiting for approval');
        console.log('   meetingId:', meetingId);
        console.log('   userId:', userId);
        console.log('   userName:', userName);

        // Join meeting room first
        console.log('ðŸ”Œ Emitting join-meeting...');
        socket.emit('join-meeting', { meetingId, userId });

        // After joining, notify host that we're requesting approval
        setTimeout(() => {
            console.log('ðŸ“¨ Emitting request-approval to host...');
            socket.emit('request-approval', {
                meetingId,
                user: {
                    _id: userId,
                    name: userName,
                    email: userEmail
                }
            });
            console.log('âœ… request-approval emitted');
        }, 500);

        socket.on('participant-approved', (data) => {
            if (data.userId === userId) {
                window.location.href = '/meeting/' + meetingId;
            }
        });

        socket.on('participant-denied', (data) => {
            if (data.userId === userId) {
                alert('Your request to join was denied by the host');
                window.location.href = '/meeting';
            }
        });
    </script>
    ` }) %>